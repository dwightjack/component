<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

# Component

`Component` is an extensible class constructor which provides the building block of Yuzu component system.

```js
const instance = new Component({ ... })
```

> **Lifecycle**
>
> | stage    | hooks     |
> | -------- | --------- |
> | `create` | `created` |

### Instance properties

-   `$active` **Boolean**: `true` if the instance is mounted and initialized
-   `options` **{ [string]&#x3A; any }**: instance options (see [defaultOptions][2])
-   `state` **{ [string]&#x3A; any }**: instance state (see [setState][3])
-   `$el` **[Element][1]**: The instance root DOM element (see [mount][4])
-   `$els` **{ [string]&#x3A; [Element][1] }**: Object mapping references to component's child DOM elements (see [selectors][5])
-   `$refs` **{ [string]&#x3A; Component }**: Object mapping references to child components (see [setRef][6])
-   `selectors` **{ [string]&#x3A; string }**: Object mapping a child element's reference name and a CSS selector
-   `listeners` **{ [string]&#x3A; function|string }**: Object mapping DOM listeners and handlers (see [setListener][7])
-   `actions` **{ [string]&#x3A; function|string }**: Object mapping state keys and functions to executed on state update

[1]: https://developer.mozilla.org/docs/Web/API/Element

## Parameters

-   `options` **[object][8]** Instance options (optional, default `{}`)

Returns **[Component][9]** 

## mount

```js
mount(el, [state])
```

Mounts a component's instance on a DOM element and initializes it.
To prevent this second behavior set `state` to `null`

Lifecycle stage: `mount`

Lifecycle hooks:

-   `beforeMount` just after attaching the root element (this.$el) but before any listener and selector registration
-   `initialize` (if `state` !== null)
-   `ready` (if `state` !== null)
-   `mounted`

### Parameters

-   `el` **([string][10] \| [Element][11])** Component's root element
-   `state` **([object][8] | null)** initial state (optional, default `{}`)

Returns **[Component][9]** 

## init

```js
init([state])
```

Initializes the component instance

**Lifecycle stage**: `init`

**Lifecycle hooks:**

-   `initialize` (if `state` !== null)
-   `ready` (if `state` !== null)

### Parameters

-   `state` **([object][8] | null)** initial state (optional, default `{}`)

Returns **[Component][9]** 

## created

Lifecycle hook called on instance creation

## beforeMount

Lifecycle hook called just before mounting the instance onto the root element

## mounted

Lifecycle hook called when the instance gets mounted onto a DOM element

## initialize

Lifecycle hook called before instance initialization.

## ready

Lifecycle hook called after instance initialization. State and event binding are already in place

## beforeDestroy

Lifecycle hook called just before closing child refs

## getState

```js
getState(key)
```

Returns a state property

### Parameters

-   `key` **[string][10]** State property to return

### Examples

```javascript
const instance = new Component().mount('#app', { a: 1 });
// instance.getState('a') === 1
```

Returns **any** 

## shouldUpdateState

```js
shouldUpdateState(string, currentValue, newValue)
```

Executes a strict inequality comparison (`!==`) on the passed-in values and returns the result.
This method is executed on `setState` calls.

You can overwrite this method with your own validation logic.

### Parameters

-   `key` **[string][10]** State property name
-   `currentValue` **any** value stored in the current state
-   `newValue` **any** New value

Returns **[boolean][12]** 

## setState

```js
setState(updater, [silent])
```

Sets internal state property(ies). Creates a shallow copy of the current state.
If the computed new state is different from the old one it emits a `change:<property>` event for every changed property
as well as a `change:*` event

To prevent this behavior set the second argument to `true` (silent update)

If the new value argument is a function, it will be executed with the current state as argument.
The returned value will be used to update the state.

### Parameters

-   `updater` **([object][8] \| [function][13])** Defines which part of the state must be updated.
-   `silent` **[boolean][12]** Update the state without emitting change events (optional, default `false`)

### Examples

```javascript
instance.on('change:a', (next, prev) => console.log(next, prev));
instance.setState({ a: 1 }); //emits 'change:a' -> logs undefined,1

instance.setState({ a: 1 }); //nothing happens
instance.setState({ a: 2 }, true); //nothing happens, again...

// use the current state to calculate its next value
instance.setState(({ a }) => ({a + 1}));
```

## replaceState

```js
replaceState(newState, [silent])
```

Replaces the current state of the instance with a completely new state

### Parameters

-   `newState` **[object][8]** The new state object.
-   `silent` **[boolean][12]** Replace the state without emitting change events (optional, default `false`)

### Examples

```javascript
instance.replaceState({ a: 1 });
// instance.state.a === 1
instance.replaceState({ b: 2 });
// instance.state.b === 2
// instance.state.a === undefined
```

## broadcast

```js
broadcast(event, [...params])
```

Emits a `broadcast:<eventname>` event to every child component listed as a `$ref`

### Parameters

-   `event` **[string][10]** Event name
-   `params` **[Array][14]&lt;any>?** Additional arguments to pass to the handler

### Examples

```javascript
const child = new Component('#child');
child.on('broadcast:log', (str) => console.log(str));

instance.setRef({ id: 'child', component: child });
instance.broadcast('log', 'test') // child component logs 'test'
```

## setListener

```js
setListener(string, handler)
```

Sets a DOM event listener.

The first argument must be a string composed by an event name (ie `click`) and a CSS selector (`.element`)
separated by a space.

If the CSS selector starts with `@` the listener will be attached the the
corresponding reference element in the instance (`this.$els.<element>`), if any.

### Parameters

-   `def` **[string][10]** Event and target element definition. Format `eventName [target]`
-   `handler` **[function][13]** Event handler

### Examples

```javascript
// attach a click handler to a child element
instance.setListener('click .button', () => ...)

// attach a click handler to this.$els.btn
instance.setListener('click @btn', () => ...)

// attach a click handler to this.$el
instance.setListener('click', () => ...)
```

## removeListeners

```js
removeListeners()
```

Removes all DOM event listeners attached with `.setListener`.

## setRef

```js
setRef(config, [props])
```

Attaches a reference to a child component.

If a reference `id` is already attached, the previous one is destroyed and replaced with the new one

### Parameters

-   `refCfg`  
-   `props` **[object][8]?** Child component initial state.
-   `config` **[object][8]** A child component configuration object
    -   `config.id` **[string][10]** Reference id. Will be used to set a reference to the child component onto `this.$refs`
    -   `config.component` **component** Component constructor or component instance
    -   `config.el` **([string][10] \| [HTMLElement][15])** Child component root element. Ignored if `config.component` is a component instance
    -   `config.on` **[Object][8]** Child component event listeners. Format `{ 'eventname': handler }`
    -   `config.null` **any** -   Any other property listed here will be passed to the constructor as option

### Examples

```javascript
const parent = new Component('#root');

class ChildComponent extends Component {}

// as constructor
parent.setRef({
  id: 'child',
  component: ChildComponent,
  el: '#child',
  // other options here...
});

// as instance
parent.setRef({
  id: 'child',
  component: new ChildComponent({ ... }).mount('#child', null) // <-- prevent component init
});

// sync parent - child state
// updates child `parentCount` state whenever `parent.state.count` changes
parent.setRef({
  id: 'child',
  component: ChildComponent,
  el: '#child',
  // other options here...
}, {
  parentCount: (parentState) => parentState.count
});
```

Returns **[Promise][16]** 

## closeRefs

Calls `.destroy()` on every child references and detaches them from the parent component.

Returns **[Promise][16]** 

## destroy

```js
destroy()
```

Detaches DOM events, instance's events and destroys all references as well

Lifecycle stage: `destoy`

Lifecycle hooks:

-   `beforeDestroy`

Returns **[Promise][16]** 

## &lt;static> isComponent

```js
Component.isComponent(obj)
```

Checks whether the passed-in value is a Component constructor

### Parameters

-   `value` **any** 

Returns **[boolean][12]** 

## &lt;static> UID_DATA_ATTR

```js
Component.UID_DATA_ATTR
```

Component root element attribute marker

Returns **[object][8]** 

## &lt;static> defaultOptions

```js
Component.defaultOptions()
```

Returns an object with default options

Returns **[object][8]** 

[2]: #defaultOptions

[3]: #setState

[4]: #mount

[5]: #selectors

[6]: #setRef

[7]: #setListener

[8]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[9]: #component

[10]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[11]: https://developer.mozilla.org/docs/Web/API/Element

[12]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[13]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[14]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[15]: https://developer.mozilla.org/docs/Web/HTML/Element

[16]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise
